<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - Music Festival Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h2>ðŸŽµ Festival Hub</h2>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="events.html" class="nav-link">Events</a>
                <a href="bookings.html" class="nav-link active">My Bookings</a>
                <a href="about.html" class="nav-link">About</a>
                <div id="authSection">
                    <a href="login.html" class="nav-link login-btn">Login</a>
                </div>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <div class="header-content">
                    <h1 class="page-title">My Bookings</h1>
                    <p class="page-subtitle">Manage your festival tickets and bookings</p>
                </div>
            </div>
        </section>

        <!-- Bookings Section -->
        <section class="bookings-section">
            <div class="container">
                <!-- Booking Stats -->
                <div class="booking-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalBookings">0</h3>
                            <p>Total Bookings</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="upcomingEvents">0</h3>
                            <p>Upcoming Events</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalSpent">â‚¹0</h3>
                            <p>Total Spent</p>
                        </div>
                    </div>
                </div>

                <!-- Filter Options -->
                <div class="booking-filters">
                    <div class="filter-group">
                        <label for="statusFilter">Filter by Status:</label>
                        <select id="statusFilter" class="filter-select">
                            <option value="all">All Bookings</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="pending">Pending</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dateFilter">Filter by Date:</label>
                        <select id="dateFilter" class="filter-select">
                            <option value="all">All Dates</option>
                            <option value="upcoming">Upcoming</option>
                            <option value="past">Past Events</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <input type="text" id="searchBookings" placeholder="Search bookings..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <!-- Bookings List -->
                <div class="bookings-container">
                    <div id="bookingsList" class="bookings-list">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <h3>No Bookings Found</h3>
                    <p>You haven't booked any tickets yet. Explore our amazing festivals and book your first ticket!</p>
                    <a href="events.html" class="cta-button primary">
                        <span>Browse Events</span>
                        <div class="button-glow"></div>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Festival Hub</h3>
                    <p>Your gateway to the best music festivals in India. Experience unforgettable moments with world-class artists.</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="bookings.html">My Bookings</a></li>
                        <li><a href="profile.html">Profile</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Refund Policy</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <div class="contact-info">
                        <p><i class="fas fa-phone"></i> +91 98765 43210</p>
                        <p><i class="fas fa-envelope"></i> support@festivalhub.in</p>
                        <p><i class="fas fa-map-marker-alt"></i> Mumbai, Maharashtra, India</p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Festival Hub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Booking Detail Modal -->
    <div id="bookingDetailModal" class="booking-modal">
        <div class="modal-overlay" onclick="closeBookingDetail()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Booking Details</h2>
                <button class="close-btn" onclick="closeBookingDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="bookingDetailContent" class="modal-body">
                <!-- Booking details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="auth-manager.js"></script>
    <script src="script.js"></script>
    <script>
        // Bookings Page Functionality
        class BookingsManager {
            constructor() {
                this.bookings = JSON.parse(localStorage.getItem('bookings')) || [];
                this.filteredBookings = [...this.bookings];
                this.init();
            }

            init() {
                this.loadBookings();
                this.updateStats();
                this.setupFilters();
                this.setupSearch();
            }

            loadBookings() {
                const bookingsList = document.getElementById('bookingsList');
                const emptyState = document.getElementById('emptyState');

                if (this.filteredBookings.length === 0) {
                    bookingsList.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                bookingsList.style.display = 'grid';
                emptyState.style.display = 'none';

                bookingsList.innerHTML = this.filteredBookings.map(booking => `
                    <div class="booking-card" onclick="showBookingDetail('${booking.id}')">
                        <div class="booking-header">
                            <div class="event-info">
                                <h3 class="event-name">${booking.eventName}</h3>
                                <p class="event-date">
                                    <i class="fas fa-calendar"></i>
                                    ${new Date(booking.eventDate).toLocaleDateString('en-IN', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })}
                                </p>
                            </div>
                            <div class="booking-status ${booking.status}">
                                <span class="status-text">${booking.status.toUpperCase()}</span>
                            </div>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${booking.eventVenue}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-ticket-alt"></i>
                                <span>${booking.ticketType} Ã— ${booking.quantity}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-rupee-sign"></i>
                                <span>â‚¹${booking.totalPrice}</span>
                            </div>
                        </div>
                        
                        <div class="booking-actions">
                            <button class="action-btn view-btn" onclick="event.stopPropagation(); showBookingDetail('${booking.id}')">
                                <i class="fas fa-eye"></i>
                                View Details
                            </button>
                            ${this.isUpcoming(booking.eventDate) ? `
                                <button class="action-btn cancel-btn" onclick="event.stopPropagation(); cancelBooking('${booking.id}')">
                                    <i class="fas fa-times"></i>
                                    Cancel
                                </button>
                            ` : ''}
                            <button class="action-btn download-btn" onclick="event.stopPropagation(); downloadTicket('${booking.id}')">
                                <i class="fas fa-download"></i>
                                Download
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                const totalBookings = this.bookings.length;
                const upcomingEvents = this.bookings.filter(booking => 
                    this.isUpcoming(booking.eventDate) && booking.status === 'confirmed'
                ).length;
                const totalSpent = this.bookings.reduce((sum, booking) => 
                    booking.status === 'confirmed' ? sum + booking.totalPrice : sum, 0
                );

                document.getElementById('totalBookings').textContent = totalBookings;
                document.getElementById('upcomingEvents').textContent = upcomingEvents;
                document.getElementById('totalSpent').textContent = `â‚¹${totalSpent.toLocaleString('en-IN')}`;
            }

            setupFilters() {
                const statusFilter = document.getElementById('statusFilter');
                const dateFilter = document.getElementById('dateFilter');

                statusFilter.addEventListener('change', () => this.applyFilters());
                dateFilter.addEventListener('change', () => this.applyFilters());
            }

            setupSearch() {
                const searchInput = document.getElementById('searchBookings');
                searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase();
                    this.applyFilters();
                });
            }

            applyFilters() {
                const statusFilter = document.getElementById('statusFilter').value;
                const dateFilter = document.getElementById('dateFilter').value;
                const searchTerm = this.searchTerm || '';

                this.filteredBookings = this.bookings.filter(booking => {
                    // Status filter
                    if (statusFilter !== 'all' && booking.status !== statusFilter) {
                        return false;
                    }

                    // Date filter
                    if (dateFilter === 'upcoming' && !this.isUpcoming(booking.eventDate)) {
                        return false;
                    }
                    if (dateFilter === 'past' && this.isUpcoming(booking.eventDate)) {
                        return false;
                    }

                    // Search filter
                    if (searchTerm && !booking.eventName.toLowerCase().includes(searchTerm) &&
                        !booking.eventVenue.toLowerCase().includes(searchTerm)) {
                        return false;
                    }

                    return true;
                });

                this.loadBookings();
            }

            isUpcoming(eventDate) {
                return new Date(eventDate) > new Date();
            }
        }

        // Global functions
        function showBookingDetail(bookingId) {
            const booking = JSON.parse(localStorage.getItem('bookings')).find(b => b.id === bookingId);
            if (!booking) return;

            const modal = document.getElementById('bookingDetailModal');
            const content = document.getElementById('bookingDetailContent');

            content.innerHTML = `
                <div class="booking-detail-card">
                    <div class="detail-header">
                        <h3>${booking.eventName}</h3>
                        <div class="status-badge ${booking.status}">${booking.status.toUpperCase()}</div>
                    </div>
                    
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h4><i class="fas fa-calendar"></i> Event Information</h4>
                            <div class="info-item">
                                <label>Date:</label>
                                <span>${new Date(booking.eventDate).toLocaleDateString('en-IN', { 
                                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                                })}</span>
                            </div>
                            <div class="info-item">
                                <label>Venue:</label>
                                <span>${booking.eventVenue}</span>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-ticket-alt"></i> Ticket Details</h4>
                            <div class="info-item">
                                <label>Type:</label>
                                <span>${booking.ticketType}</span>
                            </div>
                            <div class="info-item">
                                <label>Quantity:</label>
                                <span>${booking.quantity}</span>
                            </div>
                            <div class="info-item">
                                <label>Total Price:</label>
                                <span>â‚¹${booking.totalPrice}</span>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-user"></i> Booking Information</h4>
                            <div class="info-item">
                                <label>Name:</label>
                                <span>${booking.fullName}</span>
                            </div>
                            <div class="info-item">
                                <label>Email:</label>
                                <span>${booking.email}</span>
                            </div>
                            <div class="info-item">
                                <label>Booking Date:</label>
                                <span>${new Date(booking.bookingDate).toLocaleDateString('en-IN')}</span>
                            </div>
                            <div class="info-item">
                                <label>Booking ID:</label>
                                <span>${booking.id}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeBookingDetail() {
            const modal = document.getElementById('bookingDetailModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
                const bookingIndex = bookings.findIndex(b => b.id === bookingId);
                
                if (bookingIndex !== -1) {
                    bookings[bookingIndex].status = 'cancelled';
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    
                    // Reload the page
                    window.location.reload();
                }
            }
        }

        function downloadTicket(bookingId) {
            // Simulate ticket download
            alert('Ticket download started! Check your downloads folder.');
        }

        // Initialize bookings manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new BookingsManager();
        });

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeBookingDetail();
            }
        });
    </script>
</body>
</html>
